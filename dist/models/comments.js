"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const marked = require('marked');
const Comment = require('../lib/mongo').Comment;
Comment.plugin('contentToHtml', {
    afterFind: function (comments) {
        return comments.map(comment => {
            comment.content = marked(comment.content);
            return comment;
        });
    }
});
exports.default = {
    // 创建一个留言
    create: function (comment) {
        return Comment.create(comment).exec();
    },
    // 删除一个留言
    delCommentById: function (commentId) {
        return Comment.deleteOne({ _id: commentId }).exec();
    },
    // 获取一个留言
    getCommentById: function (commentId) {
        return Comment.findOne({ _id: commentId }).exec();
    },
    // 获取留言列表
    getComments: function (postId) {
        return Comment
            .find({ postId: postId })
            .populate({ path: 'author', model: 'User' })
            .sort({ _id: 1 })
            .convertCreatedAt()
            .contentToHtml()
            .exec();
    },
    // 删除文章删除留言
    delCommentsByPostId: function (postId) {
        return Comment
            .deleteMany({ postId: postId })
            .exec();
    },
    // 通过文章 id 获取该文章下留言数
    getCommentsCount: function (postId) {
        return Comment.count({ postId: postId }).exec();
    }
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tb2RlbHMvY29tbWVudHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDakMsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztBQUVoRCxPQUFPLENBQUMsTUFBTSxDQUFDLGVBQWUsRUFBRTtJQUM1QixTQUFTLEVBQUUsVUFBUyxRQUFRO1FBQ3hCLE9BQVEsUUFBUSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUMzQixPQUFPLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDMUMsT0FBTyxPQUFPLENBQUM7UUFDbkIsQ0FBQyxDQUFDLENBQUE7SUFDTixDQUFDO0NBQ0osQ0FBQyxDQUFDO0FBRUgsa0JBQWU7SUFDWCxTQUFTO0lBQ1QsTUFBTSxFQUFFLFVBQVUsT0FBTztRQUNyQixPQUFPLE9BQU8sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDMUMsQ0FBQztJQUVELFNBQVM7SUFDVCxjQUFjLEVBQUUsVUFBVSxTQUFTO1FBQy9CLE9BQU8sT0FBTyxDQUFDLFNBQVMsQ0FBQyxFQUFDLEdBQUcsRUFBRSxTQUFTLEVBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3RELENBQUM7SUFFRCxTQUFTO0lBQ1QsY0FBYyxFQUFFLFVBQVUsU0FBUztRQUMvQixPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBQyxHQUFHLEVBQUUsU0FBUyxFQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNwRCxDQUFDO0lBRUQsU0FBUztJQUNULFdBQVcsRUFBRSxVQUFVLE1BQU07UUFDekIsT0FBTyxPQUFPO2FBQ1QsSUFBSSxDQUFDLEVBQUMsTUFBTSxFQUFFLE1BQU0sRUFBQyxDQUFDO2FBQ3RCLFFBQVEsQ0FBQyxFQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBQyxDQUFDO2FBQ3pDLElBQUksQ0FBQyxFQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUMsQ0FBQzthQUNkLGdCQUFnQixFQUFFO2FBQ2xCLGFBQWEsRUFBRTthQUNmLElBQUksRUFBRSxDQUFDO0lBQ2hCLENBQUM7SUFFRCxXQUFXO0lBQ1gsbUJBQW1CLEVBQUUsVUFBUyxNQUFNO1FBQ2hDLE9BQU8sT0FBTzthQUNULFVBQVUsQ0FBQyxFQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUMsQ0FBQzthQUM1QixJQUFJLEVBQUUsQ0FBQztJQUNoQixDQUFDO0lBRUQsb0JBQW9CO0lBQ3BCLGdCQUFnQixFQUFFLFVBQVMsTUFBTTtRQUM3QixPQUFPLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtJQUNuRCxDQUFDO0NBQ0osQ0FBQSIsImZpbGUiOiJtb2RlbHMvY29tbWVudHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBtYXJrZWQgPSByZXF1aXJlKCdtYXJrZWQnKTtcbmNvbnN0IENvbW1lbnQgPSByZXF1aXJlKCcuLi9saWIvbW9uZ28nKS5Db21tZW50O1xuXG5Db21tZW50LnBsdWdpbignY29udGVudFRvSHRtbCcsIHtcbiAgICBhZnRlckZpbmQ6IGZ1bmN0aW9uKGNvbW1lbnRzKXtcbiAgICAgICAgcmV0dXJuICBjb21tZW50cy5tYXAoY29tbWVudCA9PiB7XG4gICAgICAgICAgICBjb21tZW50LmNvbnRlbnQgPSBtYXJrZWQoY29tbWVudC5jb250ZW50KTtcbiAgICAgICAgICAgIHJldHVybiBjb21tZW50O1xuICAgICAgICB9KVxuICAgIH1cbn0pO1xuXG5leHBvcnQgZGVmYXVsdCB7XG4gICAgLy8g5Yib5bu65LiA5Liq55WZ6KiAXG4gICAgY3JlYXRlOiBmdW5jdGlvbiAoY29tbWVudCl7XG4gICAgICAgIHJldHVybiBDb21tZW50LmNyZWF0ZShjb21tZW50KS5leGVjKCk7XG4gICAgfSxcblxuICAgIC8vIOWIoOmZpOS4gOS4queVmeiogFxuICAgIGRlbENvbW1lbnRCeUlkOiBmdW5jdGlvbiAoY29tbWVudElkKXtcbiAgICAgICAgcmV0dXJuIENvbW1lbnQuZGVsZXRlT25lKHtfaWQ6IGNvbW1lbnRJZH0pLmV4ZWMoKTtcbiAgICB9LFxuXG4gICAgLy8g6I635Y+W5LiA5Liq55WZ6KiAXG4gICAgZ2V0Q29tbWVudEJ5SWQ6IGZ1bmN0aW9uIChjb21tZW50SWQpe1xuICAgICAgICByZXR1cm4gQ29tbWVudC5maW5kT25lKHtfaWQ6IGNvbW1lbnRJZH0pLmV4ZWMoKTtcbiAgICB9LFxuXG4gICAgLy8g6I635Y+W55WZ6KiA5YiX6KGoXG4gICAgZ2V0Q29tbWVudHM6IGZ1bmN0aW9uIChwb3N0SWQpe1xuICAgICAgICByZXR1cm4gQ29tbWVudFxuICAgICAgICAgICAgLmZpbmQoe3Bvc3RJZDogcG9zdElkfSlcbiAgICAgICAgICAgIC5wb3B1bGF0ZSh7cGF0aDogJ2F1dGhvcicsIG1vZGVsOiAnVXNlcid9KVxuICAgICAgICAgICAgLnNvcnQoe19pZDogMX0pXG4gICAgICAgICAgICAuY29udmVydENyZWF0ZWRBdCgpXG4gICAgICAgICAgICAuY29udGVudFRvSHRtbCgpXG4gICAgICAgICAgICAuZXhlYygpO1xuICAgIH0sXG5cbiAgICAvLyDliKDpmaTmlofnq6DliKDpmaTnlZnoqIBcbiAgICBkZWxDb21tZW50c0J5UG9zdElkOiBmdW5jdGlvbihwb3N0SWQpe1xuICAgICAgICByZXR1cm4gQ29tbWVudFxuICAgICAgICAgICAgLmRlbGV0ZU1hbnkoe3Bvc3RJZDogcG9zdElkfSlcbiAgICAgICAgICAgIC5leGVjKCk7XG4gICAgfSxcblxuICAgIC8vIOmAmui/h+aWh+eroCBpZCDojrflj5bor6Xmlofnq6DkuIvnlZnoqIDmlbBcbiAgICBnZXRDb21tZW50c0NvdW50OiBmdW5jdGlvbihwb3N0SWQpIHtcbiAgICAgICAgcmV0dXJuIENvbW1lbnQuY291bnQoeyBwb3N0SWQ6IHBvc3RJZCB9KS5leGVjKClcbiAgICB9XG59XG4iXX0=
